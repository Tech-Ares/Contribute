(window.webpackJsonp=window.webpackJsonp||[]).push([["chat-components-sideList"],{1154:function(e,t,c){},"819a7":function(e,t,c){"use strict";c("1154")},dcb7:function(e,t,c){"use strict";c.r(t);var n=c("1da1"),r=(c("96cf"),c("b0c0"),c("4160"),c("d3b7"),c("159b"),c("caad"),c("2532"),c("ac1f"),c("466d"),c("3ca3"),c("ddb0"),c("b64b"),c("45fc"),c("fb6a"),c("7a23")),a=c("23f9"),o=c("3ef4"),l=c("5502"),i=Object(r.createTextVNode)("最近"),u=["onClick"],s={class:"details"},b=["textContent"],m={key:0,class:"type group"},p={key:1,class:"type room"},d=["onClick"],f={class:"details"},g=["textContent"],O={class:"kxTable-pagination-box"},j={class:"kxTable-do"},h=["onClick"],k={class:"details"},v=["textContent"],C={class:"kxTable-pagination-box"},x={class:"kxTable-do"},N=["onClick"],y={class:"details"},T=["textContent"],V={class:"kxTable-pagination-box"},w={class:"kxTable-do"},I={emits:["get-current-msg"],setup:function(e,t){var c,I=t.expose,B=t.emit,z=Object(r.getCurrentInstance)().appContext,_=Object(l.c)(),E=Object(r.reactive)({recent:!1,contact:!1,chatgroup:!1,chatroom:!1}),P=Object(r.computed)((function(){return _.state.user.activeTab||"recent"})),A=function(e){if(console.log(e),e.props)if("recent"==e.props.name)_.commit("setActiveTab","recent"),K(U,600,!0)();else if("contact"==e.props.name)_.commit("setActiveTab","contact"),K(G,600,!0)();else if("chatgroup"==e.props.name)_.commit("setActiveTab","chatgroup"),K($,600,!0)();else if("chatroom"==e.props.name)_.commit("setActiveTab","chatroom"),K(F,600,!0)();else{if("me"!=e.props.name)return o.a.error("参数错误: 不存在此选项卡！");_.commit("setActiveTab","me"),K(J,600,!0)()}else if("recent"==e)_.commit("setActiveTab","recent"),K(U,600,!0)();else if("contact"==e)_.commit("setActiveTab","contact"),K(G,600,!0)();else if("chatgroup"==e)_.commit("setActiveTab","chatgroup"),K($,600,!0)();else if("chatroom"==e)_.commit("setActiveTab","chatroom"),K(F,600,!0)();else{if("me"!=e)return o.a.error("参数错误: 不存在此选项卡！");_.commit("setActiveTab","me"),K(J,600,!0)()}},R=Object(r.reactive)({recents:Object(r.computed)((function(){return _.state.user.recent})),contacts:Object(r.computed)((function(){return _.state.user.contact})),chatrooms:Object(r.computed)((function(){return _.state.user.chatroom})),chatgroups:Object(r.computed)((function(){return _.state.user.chatgroup})),recentTabNotice:Object(r.computed)((function(){return _.state.user.recentTabNotice}))}),S=Object(r.reactive)({contact:{page:1,size:10},contactTotal:0,chatroom:{page:1,size:10},chatroomTotal:0,chatgroup:{page:1,size:10},chatgroupTotal:0}),D=function(e){"contact"==P.value&&(S.contact.page=e,G()),"chatgroup"==P.value&&(S.chatgroup.page=e,$()),"chatroom"==P.value&&(S.chatroom.page=e,F())},L=function(e){"contact"==e&&K(G,800,!0)(),"chatgroup"==e&&K($,800,!0)(),"chatroom"==e&&K(F,800,!0)()},U=function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t,c,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,E.recent=!0,e.next=4,a.a.conn.getSessionList();case 4:if((t=e.sent).data.channel_infos&&0!=t.data.channel_infos.length){e.next=7;break}throw new Error("无最近联系人");case 7:return console.log(t),c=t.data.channel_infos,console.log(c),n=[],r=[],c.forEach((function(e,t,c){c[t].meta.payload=JSON.parse(c[t].meta.payload),c[t].channel_id.includes("@conference")?(n.push(c[t].channel_id.match(/_(\S*)@/)[1]),c[t].targetId=c[t].channel_id.match(/_(\S*)@/)[1],c[t].isChatroom=!0):(r.push(c[t].channel_id.match(/_(\S*)@/)[1]),c[t].targetId=c[t].channel_id.match(/_(\S*)@/)[1],c[t].isChatroom=!1)})),console.log(c),console.log(n),console.log(r),e.next=18,Promise.all([z.config.globalProperties.$API.imApi.getContactById.post({targetIds:r}),z.config.globalProperties.$API.imApi.getChatroomById.post({targetIds:n})]).then((function(e){console.log(e),Object.keys(e).forEach((function(t){e[t].data&&e[t].data.forEach((function(e){c.some((function(t){if(t.targetId==e.targetId&&t.isChatroom)return t.avatar=e.avatar,t.chatRoomName=e.nickName,t.chatRoomId=e.czimId,t.czType=e.czType,t.isProhibit=e.isProhibit,t.maxusers=e.maxusers,!0;t.targetId!=e.targetId||t.isChatroom||(t.avatar=e.avatar,t.nickName=e.nickName,t.czType=e.czType)}))}))})),console.log(c)}));case 18:_.commit("setRecent",c),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(0),console.log(e.t0);case 24:return e.prev=24,E.recent=!1,e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[0,21,24,27]])})));return function(){return e.apply(this,arguments)}}(),G=function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.contact=!0,e.next=3,z.config.globalProperties.$API.imApi.getContacts.post(S.contact);case 3:if(t=e.sent,console.log(t),E.contact=!1,0===t.code){e.next=8;break}return e.abrupt("return",o.a.warning("获取联系人失败"));case 8:_.commit("setContact",t.data.rows),S.contactTotal=t.data.total;case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.chatgroup=!0,e.next=3,z.config.globalProperties.$API.imApi.getChatGroup.post(S.chatgroup);case 3:if(t=e.sent,console.log(t),E.chatgroup=!1,0===t.code){e.next=8;break}return e.abrupt("return",o.a.warning("获取群聊失败"));case 8:_.commit("setChatgroup",t.data.rows),S.chatgroupTotal=t.data.total;case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.chatroom=!0,e.next=3,z.config.globalProperties.$API.imApi.getChatroom.post(S.chatroom);case 3:if(t=e.sent,console.log(t),E.chatroom=!1,0===t.code){e.next=8;break}return e.abrupt("return",o.a.warning("获取聊天室失败"));case 8:_.commit("setChatroom",t.data.rows),S.chatroomTotal=t.data.total;case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.conn.fetchUserInfoById(_.state.user.userSecret.userId);case 2:t=e.sent,console.log(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),q=Object(r.computed)((function(){return _.state.user.currentChat||{}})),H=function(e){q.value.targetId!==e.targetId&&(_.commit("setCurrentChat",e),"recent"==P.value&&(B("get-current-msg",e.targetId,e.czType),_.dispatch("channelClearUnread",e)),"contact"==P.value&&B("get-current-msg",e.targetId,e.czType),"chatgroup"==P.value&&B("get-current-msg",e.targetId,e.czType),"chatroom"==P.value&&B("get-current-msg",e.targetId,e.czType))};function K(e,t,n){return function(){var r=this,a=Array.prototype.slice.call(arguments);if(c&&clearTimeout(c),n){var o=!c;c=setTimeout((function(){c=null}),t),o&&e.apply(r,a)}else c=setTimeout((function(){e.apply(r,a)}),t)}}return I({getContacts:G,getRecent:U,switchTab:A}),function(e,t){var c=Object(r.resolveComponent)("el-badge"),n=Object(r.resolveComponent)("el-avatar"),a=Object(r.resolveComponent)("el-empty"),o=Object(r.resolveComponent)("el-scrollbar"),l=Object(r.resolveComponent)("el-tab-pane"),I=Object(r.resolveComponent)("el-pagination"),B=Object(r.resolveComponent)("el-button"),z=Object(r.resolveComponent)("el-tabs"),_=Object(r.resolveDirective)("loading");return Object(r.openBlock)(),Object(r.createBlock)(z,{type:"border-card",modelValue:Object(r.unref)(P),"onUpdate:modelValue":t[6]||(t[6]=function(e){return Object(r.isRef)(P)?P.value=e:null}),onTabClick:A},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(l,{name:"recent",lazy:""},{label:Object(r.withCtx)((function(){return[Object(r.createVNode)(c,{value:Object(r.unref)(R).recentTabNotice,hidden:"recent"==Object(r.unref)(P)||0===Object(r.unref)(R).recentTabNotice},{default:Object(r.withCtx)((function(){return[i]})),_:1},8,["value","hidden"])]})),default:Object(r.withCtx)((function(){return[Object(r.withDirectives)(Object(r.createVNode)(o,{class:"scroll-content",ref:function(e,t){t.scrollbar=e},"element-loading-text":"正在获取最近联系人..."},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(r.TransitionGroup,{name:"el-zoom-in-center"},{default:Object(r.withCtx)((function(){return[(Object(r.openBlock)(!0),Object(r.createElementBlock)(r.Fragment,null,Object(r.renderList)(Object(r.unref)(R).recents,(function(e){return Object(r.openBlock)(),Object(r.createElementBlock)("div",{class:Object(r.normalizeClass)(["contact-card",{select:Object(r.unref)(q).targetId==e.targetId}]),onClick:function(t){return H(e)},key:e.targetId},[Object(r.createVNode)(c,{value:e.unread_num,hidden:0==e.unread_num,max:10},{default:Object(r.withCtx)((function(){return[e.avatar&&e.avatar.length>0?(Object(r.openBlock)(),Object(r.createBlock)(n,{key:0,shape:"circle",size:40,src:e.avatar},null,8,["src"])):(Object(r.openBlock)(),Object(r.createBlock)(n,{key:1,shape:"circle",size:40},{default:Object(r.withCtx)((function(){return[Object(r.createTextVNode)(Object(r.toDisplayString)(e.nickName.substring(0,1)||e.chatRoomName.substring(0,1)||e.groupName.substring(0,1)),1)]})),_:2},1024))]})),_:2},1032,["value","hidden"]),Object(r.createElementVNode)("div",s,[Object(r.createElementVNode)("span",{class:"user-name",textContent:Object(r.toDisplayString)(e.nickName||e.chatRoomName)},null,8,b),1===e.czType?(Object(r.openBlock)(),Object(r.createElementBlock)("span",m,"群聊")):Object(r.createCommentVNode)("",!0),2===e.czType?(Object(r.openBlock)(),Object(r.createElementBlock)("span",p,"聊天室")):Object(r.createCommentVNode)("",!0)])],10,u)})),128))]})),_:1}),Object(r.unref)(R).recents&&0!=Object(r.unref)(R).recents.length?Object(r.createCommentVNode)("",!0):(Object(r.openBlock)(),Object(r.createBlock)(a,{key:0,description:"暂无联系人","image-size":100}))]})),_:1},512),[[_,Object(r.unref)(E).recent]])]})),_:1}),Object(r.createVNode)(l,{label:"好友",name:"contact",lazy:""},{default:Object(r.withCtx)((function(){return[Object(r.withDirectives)(Object(r.createVNode)(o,{class:"scroll-content",ref:function(e,t){t.scrollbar=e},"element-loading-text":"正在获取好友..."},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(r.TransitionGroup,{name:"el-zoom-in-center"},{default:Object(r.withCtx)((function(){return[(Object(r.openBlock)(!0),Object(r.createElementBlock)(r.Fragment,null,Object(r.renderList)(Object(r.unref)(R).contacts,(function(e){return Object(r.openBlock)(),Object(r.createElementBlock)("div",{class:Object(r.normalizeClass)(["contact-card",{select:Object(r.unref)(q).targetId==e.targetId}]),onClick:function(t){return H(e)},key:e.targetId},[Object(r.createVNode)(c,{value:e.unRead,max:10},{default:Object(r.withCtx)((function(){return[e.avatar?(Object(r.openBlock)(),Object(r.createBlock)(n,{key:0,shape:"circle",size:40,src:e.avatar},null,8,["src"])):(Object(r.openBlock)(),Object(r.createBlock)(n,{key:1,shape:"circle",size:40},{default:Object(r.withCtx)((function(){return[Object(r.createTextVNode)(Object(r.toDisplayString)(e.nickName.substring(0,1)),1)]})),_:2},1024))]})),_:2},1032,["value"]),Object(r.createElementVNode)("div",f,[Object(r.createElementVNode)("span",{class:"user-name",textContent:Object(r.toDisplayString)(e.nickName)},null,8,g)])],10,d)})),128))]})),_:1}),Object(r.unref)(R).contacts&&0!=Object(r.unref)(R).contacts.length?Object(r.createCommentVNode)("",!0):(Object(r.openBlock)(),Object(r.createBlock)(a,{key:0,description:"暂无好友","image-size":100}))]})),_:1},512),[[_,Object(r.unref)(E).contact]]),Object(r.createElementVNode)("div",O,[Object(r.createVNode)(I,{class:"kxTable-pagination",background:"",small:!0,layout:"total, prev, pager, next",total:Object(r.unref)(S).contactTotal,currentPage:Object(r.unref)(S).contact.page,"onUpdate:currentPage":t[0]||(t[0]=function(e){return Object(r.unref)(S).contact.page=e}),onCurrentChange:D},null,8,["total","currentPage"]),Object(r.createElementVNode)("div",j,[Object(r.createVNode)(B,{onClick:t[1]||(t[1]=function(e){return L("contact")}),icon:"el-icon-refresh",circle:"",style:{"margin-left":"15px"}})])])]})),_:1}),Object(r.createVNode)(l,{label:"群聊",name:"chatgroup",lazy:""},{default:Object(r.withCtx)((function(){return[Object(r.withDirectives)(Object(r.createVNode)(o,{class:"scroll-content",ref:function(e,t){t.scrollbar=e},"element-loading-text":"正在获取群聊..."},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(r.TransitionGroup,{name:"el-zoom-in-center"},{default:Object(r.withCtx)((function(){return[(Object(r.openBlock)(!0),Object(r.createElementBlock)(r.Fragment,null,Object(r.renderList)(Object(r.unref)(R).chatgroups,(function(e){return Object(r.openBlock)(),Object(r.createElementBlock)("div",{class:Object(r.normalizeClass)(["contact-card",{select:Object(r.unref)(q).targetId==e.targetId}]),key:e.targetId,onClick:function(t){return H(e)}},[Object(r.createVNode)(n,{shape:"square",size:40,src:e.groupImg||"//cube.elemecdn.com/9/c2/f0ee8a3c7c9638a54940382568c9dpng.png"},null,8,["src"]),Object(r.createElementVNode)("div",k,[Object(r.createElementVNode)("span",{class:"user-name",textContent:Object(r.toDisplayString)(e.groupName)},null,8,v)])],10,h)})),128))]})),_:1}),0==Object(r.unref)(R).chatgroups.length?(Object(r.openBlock)(),Object(r.createBlock)(a,{key:0,description:"暂无群聊","image-size":100})):Object(r.createCommentVNode)("",!0)]})),_:1},512),[[_,Object(r.unref)(E).chatgroup]]),Object(r.createElementVNode)("div",C,[Object(r.createVNode)(I,{background:"",small:!0,layout:"total, prev, pager, next",total:Object(r.unref)(S).chatgroupTotal,currentPage:Object(r.unref)(S).chatgroup.page,"onUpdate:currentPage":t[2]||(t[2]=function(e){return Object(r.unref)(S).chatgroup.page=e}),onCurrentChange:D},null,8,["total","currentPage"]),Object(r.createElementVNode)("div",x,[Object(r.createVNode)(B,{onClick:t[3]||(t[3]=function(e){return L("chatgroup")}),icon:"el-icon-refresh",circle:"",style:{"margin-left":"15px"}})])])]})),_:1}),Object(r.createVNode)(l,{label:"聊天室",name:"chatroom",lazy:""},{default:Object(r.withCtx)((function(){return[Object(r.withDirectives)(Object(r.createVNode)(o,{class:"scroll-content",ref:function(e,t){t.scrollbar=e},"element-loading-text":"正在获取聊天室..."},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(r.TransitionGroup,{name:"el-zoom-in-center"},{default:Object(r.withCtx)((function(){return[(Object(r.openBlock)(!0),Object(r.createElementBlock)(r.Fragment,null,Object(r.renderList)(Object(r.unref)(R).chatrooms,(function(e){return Object(r.openBlock)(),Object(r.createElementBlock)("div",{class:Object(r.normalizeClass)(["contact-card",{select:Object(r.unref)(q).targetId==e.targetId}]),key:e.targetId,onClick:function(t){return H(e)}},[Object(r.createVNode)(n,{shape:"square",size:40,src:e.chatRoomImg||"//cube.elemecdn.com/9/c2/f0ee8a3c7c9638a54940382568c9dpng.png"},null,8,["src"]),Object(r.createElementVNode)("div",y,[Object(r.createElementVNode)("span",{class:"user-name",textContent:Object(r.toDisplayString)(e.chatRoomName)},null,8,T)])],10,N)})),128))]})),_:1}),0==Object(r.unref)(R).chatrooms.length?(Object(r.openBlock)(),Object(r.createBlock)(a,{key:0,description:"暂无聊天室","image-size":100})):Object(r.createCommentVNode)("",!0)]})),_:1},512),[[_,Object(r.unref)(E).chatroom]]),Object(r.createElementVNode)("div",V,[Object(r.createVNode)(I,{background:"",small:!0,layout:"total, prev, pager, next",total:Object(r.unref)(S).chatroomTotal,currentPage:Object(r.unref)(S).chatroom.page,"onUpdate:currentPage":t[4]||(t[4]=function(e){return Object(r.unref)(S).chatroom.page=e}),onCurrentChange:D},null,8,["total","currentPage"]),Object(r.createElementVNode)("div",w,[Object(r.createVNode)(B,{onClick:t[5]||(t[5]=function(e){return L("chatroom")}),icon:"el-icon-refresh",circle:"",style:{"margin-left":"15px"}})])])]})),_:1})]})),_:1},8,["modelValue"])}}},B=(c("819a7"),c("6b0d"));const z=c.n(B)()(I,[["__scopeId","data-v-6634360a"]]);t.default=z}}]);