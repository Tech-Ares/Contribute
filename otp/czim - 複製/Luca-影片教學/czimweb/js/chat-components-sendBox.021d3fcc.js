(window.webpackJsonp=window.webpackJsonp||[]).push([["chat-components-sendBox"],{"0a34":function(e,t,n){"use strict";n("f2f2")},"79bf":function(e,t,n){"use strict";n.r(t);var c=n("1da1"),a=n("2909"),o=(n("96cf"),n("ac1f"),n("1276"),n("b64b"),n("5319"),n("4160"),n("d3b7"),n("159b"),n("caad"),n("2532"),n("99af"),n("33d1"),n("ea98"),n("25f0"),n("fb6a"),n("d81d"),n("7a23")),r=n("23f9"),l=n("5a0c"),i=n.n(l),u=n("3ef4"),s=n("5502"),b={class:"editor-box"},d={class:"editor-bar"},v={class:"button-box"},f={key:0},j={key:1},O={class:"button-box-right"},p=Object(o.createTextVNode)("@群成员"),m=["infinite-scroll-disabled"],g=["onClick"],k=["textContent"],h={class:"finished"},C=Object(o.createTextVNode)("预设消息"),x=["onClick","innerHTML"],w=Object(o.createTextVNode)("发送"),N=["contenteditable","onKeydown"],y={key:0},V=["onClick"],B={class:"arrow"},T={emits:["to-bottom"],setup:function(e,t){var n=t.expose,l=t.emit,T=Object(o.getCurrentInstance)().appContext,E=Object(s.c)(),S={faces:"😀 😁 😂 🤣 😃 😄 😅 😆 😉 😊 😋 😎 😍 🤐 🤑 😲 ☹️ 🙁 😖 😞 😟 😤 😢 😭 😦 😧 😨 😩 🤯 😬 😮‍💨 😰 😱 🥵 🥶 😳 🤪 😵 😵‍💫 🥴 😠 😡 😶‍🌫️ 🙄".split(" "),hands:"👋 🤚 🖐️ ✋ 🖖 👌 🤌 🤏 ✌️ 🤞 🤟 🤘 🤙 👈 👉 👆 🖕 👇 ☝️ 👍 👎 ✊ 👊 🤛 🤜 👏 🙌 👐 🤲 🤝 🙏 ✍️ 💅 🤳 💪 🦾 🦿 🦵 🦶 👂 🦻 👃 🧠 🫀".split(" "),natural:"🌒 🌓 🌔 🌕 🌖 🌗 🌘 🌙 🌚 🌛 🌜 ☀️ 🌝 🌞 ⭐ 🌟 🌠 ☁️ ⛅ ⛈️ 🌤️ 🌥️ 🌦️ 🌧️ 🌨️ 🌩️ 🌪️ 🌫️ 🌬️ 🌈 ☂️ ☔ ⚡ ❄️ ☃️ ⛄ ☄️ 🔥 💧 🌊 🎄 ✨ 🎋 🎍".split(" ")},_=Object(o.ref)(0),I=[{value:0,label:"关闭"},{value:5e3,label:"5 秒"},{value:3e4,label:"30 秒"},{value:6e4,label:"60 秒"},{value:3e5,label:"五分钟"}],L=Object(o.ref)(!1),z=Object(o.ref)(!1),D=function(){R.value&&(_.value=0,z.value=!z.value)},M=Object(o.reactive)({isSending:!1,isLoadPreset:!1,isLoadAt:!1}),A=Object(o.ref)(),P=Object(o.computed)((function(){return E.state.user.currentChat})),R=Object(o.ref)(!1);Object(o.watch)(P,(function(e){console.log(e),Object.keys(e).length<=0?(R.value=!1,console.log(R.value)):(R.value=!0,console.log(R.value))}),{immediate:!0,deep:!0});var F=function(){if(M.isSending=!0,Y.value)A.value.innerText="",J(),K(),Y.value=!1;else{var e=A.value.innerText.replace(/[\n\r]$/,"");if(console.log(e),!e)return M.isSending=!1,u.a.warning("消息不能为空");var t,n=r.a.conn.getUniqueId();if(0===P.value.czType)t="contact";else if(1===P.value.czType)t="groupchat";else{if(2!==P.value.czType)return u.a.error("未知的聊天类型");t="chatroom"}var c={chatType:t,chatId:P.value.targetId,msg:e,bySelf:!0,time:i()().format("YYYY-MM-DD HH:mm:ss"),mid:n,status:"sending",ext:{nickName:E.state.user.userSecret.nickName,avatar:E.state.user.userSecret.avatar},type:"text"};if(le.value.length>0){var o=[];le.value.forEach((function(t){e.includes("@".concat(t.nickName))&&(console.log(t.targetId),o=[].concat(Object(a.a)(o),[t.targetId]))})),c.ext.at=o,_.value=0}_.value>0&&(c.ext.fireTime=_.value,delete c.ext.at,le.value=[]),console.log(c),E.dispatch("onSendText",c),A.value.innerText="",J(),le.value=[],M.isSending=!1}},H=Object(o.ref)({}),Y=Object(o.ref)(!1),U=function(e){H.value=e,console.log("文件",e);var t="image/jpeg"===e.type||"image/png"===e.type||"image/jpeg"===e.type||"image/gif"===e.type,n=e.size/1024/1024<3;return t||u.a.error("不支持的文件格式"),n||u.a.error("上传文件体积应小于 3MB!"),t&&n},K=function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){var t,n,c,a,o,l,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M.isSending=!0,t=de(32)+".png",n={headers:{"Content-Type":"multipart/form-data"}},(c=new FormData).append("file",H.value,t),e.prev=5,e.next=8,T.config.globalProperties.$API.fileUpload.upload.post("",c,n);case 8:if(a=e.sent,o=r.a.conn.getUniqueId(),0!==P.value.czType){e.next=14;break}l="contact",e.next=23;break;case 14:if(1!==P.value.czType){e.next=18;break}l="groupchat",e.next=23;break;case 18:if(2!==P.value.czType){e.next=22;break}l="chatroom",e.next=23;break;case 22:return e.abrupt("return",u.a.error("未知的聊天类型"));case 23:s={chatType:l,chatId:P.value.targetId,msg:a.data[0].imageUrl,bySelf:!0,time:i()().format("YYYY-MM-DD HH:mm:ss"),mid:o,type:"image",status:"sending",ext:{nickName:E.state.user.userSecret.nickName,avatar:E.state.user.userSecret.avatar}},console.log(s),E.dispatch("onSendImg",s),e.next=31;break;case 28:e.prev=28,e.t0=e.catch(5),console.log(e.t0);case 31:return e.prev=31,M.isSending=!1,e.finish(31);case 34:case"end":return e.stop()}}),e,null,[[5,28,31,34]])})));return function(){return e.apply(this,arguments)}}(),$=Object(o.ref)(""),q=function(e){var t=0,n=e.ownerDocument||e.document,c=n.defaultView||n.parentWindow;if(c.getSelection().rangeCount>0){var a=c.getSelection().getRangeAt(0),o=a.cloneRange();o.selectNodeContents(e),o.setEnd(a.endContainer,a.endOffset),t=o.toString().length}return t},J=function(){$.value=q(A.value),Y.value&&!A.value.getElementsByTagName("img").length&&(Y.value=!1)},G=function(e,t){var n=document.createRange();n.setStart(e.firstChild,t),n.setEnd(e.firstChild,t);var c=window.getSelection();c.removeAllRanges(),c.addRange(n)},W=Object(o.ref)(0),Q=function(){W.value<=0?W.value=0:W.value--},X=function(){W.value!=Object.keys(S).length-1?W.value++:console.log("跳出")},Z=function(){R.value&&(L.value=!L.value)},ee=Object(o.ref)(""),te=Object(o.ref)([]),ne=Object(o.ref)(!1),ce=function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!=ee.value){e.next=2;break}return e.abrupt("return");case 2:return M.isLoadPreset=!0,e.next=5,T.config.globalProperties.$API.imApi.getPresetMsg.post({msg:ee.value});case 5:if(t=e.sent,M.isLoadPreset=!1,0===t.code){e.next=9;break}return e.abrupt("return",u.a.warning("服务器异常，请刷新后重试"));case 9:te.value=t.data,te.value=te.value.map((function(e){return e=e.replace(ee.value,'<span style="color: red;">'.concat(ee.value,"</span>"))}));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ae=Object(o.ref)([]),oe=Object(o.ref)(!1),re=1,le=Object(o.ref)([]),ie=function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M.isLoadAt=!0,e.next=3,T.config.globalProperties.$API.imApi.getGroupMember.post({page:re,chatgroupId:P.value.targetId});case 3:if(t=e.sent,M.isLoadAt=!1,console.log(t),0===t.code){e.next=8;break}return e.abrupt("return",u.a.error("获取数据失败"));case 8:if(ae.value=[].concat(Object(a.a)(ae.value),Object(a.a)(t.data)),!(t.data.length<10)){e.next=13;break}return oe.value=!0,console.log(re,oe.value),e.abrupt("return");case 13:re+=1,console.log(re,oe.value);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ue=function(){ae.value=[],re=1,oe.value=!1},se=Object(o.ref)(!1),be=function(){l("to-bottom")},de=function(e){e=e||32;for(var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=t.length,c="",a=0;a<e;a++)c+=t.charAt(Math.floor(Math.random()*n));return c};return n({setPasteFile:function(e){Y.value=!0,H.value=e,console.log(A.value)},backToBottom:function(e){se.value=e},showToBottom:se}),function(e,t){var n=Object(o.resolveComponent)("sc-icon-image"),c=Object(o.resolveComponent)("el-upload"),r=Object(o.resolveComponent)("el-icon"),l=Object(o.resolveComponent)("el-tooltip"),i=Object(o.resolveComponent)("sc-icon-thumbs-up"),u=Object(o.resolveComponent)("sc-icon-hot"),s=Object(o.resolveComponent)("el-option"),T=Object(o.resolveComponent)("el-select"),E=Object(o.resolveComponent)("el-button"),H=Object(o.resolveComponent)("el-empty"),Y=Object(o.resolveComponent)("el-avatar"),re=Object(o.resolveComponent)("el-popover"),de=Object(o.resolveComponent)("el-input"),ve=Object(o.resolveComponent)("el-header"),fe=Object(o.resolveComponent)("el-scrollbar"),je=Object(o.resolveComponent)("el-main"),Oe=Object(o.resolveComponent)("el-container"),pe=Object(o.resolveComponent)("el-icon-caret-left"),me=Object(o.resolveComponent)("el-icon-caret-right"),ge=Object(o.resolveDirective)("loading"),ke=Object(o.resolveDirective)("infinite-scroll");return Object(o.openBlock)(),Object(o.createElementBlock)("div",b,[Object(o.createElementVNode)("div",d,[Object(o.createElementVNode)("ul",v,[Object(o.createElementVNode)("li",null,[Object(o.createVNode)(l,{content:"发送图片",placement:"top-start"},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(r,null,{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(c,{action:"","show-file-list":!1,"http-request":K,"before-upload":U,disabled:!R.value},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(n)]})),_:1},8,["disabled"])]})),_:1})]})),_:1})]),Object(o.createElementVNode)("li",null,[Object(o.createVNode)(l,{content:"发送表情",placement:"top-start"},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(r,{onClick:Z},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(i)]})),_:1})]})),_:1})]),0===Object(o.unref)(P).czType?(Object(o.openBlock)(),Object(o.createElementBlock)("li",f,[Object(o.createVNode)(l,{content:"阅后即焚",placement:"top-start"},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(r,{onClick:D},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(u)]})),_:1})]})),_:1})])):Object(o.createCommentVNode)("",!0),z.value&&0===Object(o.unref)(P).czType?(Object(o.openBlock)(),Object(o.createElementBlock)("li",j,[Object(o.createVNode)(T,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=function(e){return _.value=e}),placeholder:"Select"},{default:Object(o.withCtx)((function(){return[(Object(o.openBlock)(),Object(o.createElementBlock)(o.Fragment,null,Object(o.renderList)(I,(function(e){return Object(o.createVNode)(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),64))]})),_:1},8,["modelValue"])])):Object(o.createCommentVNode)("",!0)]),Object(o.createVNode)(o.Transition,{name:"el-fade-in"},{default:Object(o.withCtx)((function(){return[Object(o.withDirectives)(Object(o.createVNode)(E,{class:"tobottom",type:"info",round:"",icon:"el-icon-arrow-down-bold",onClick:be},null,512),[[o.vShow,se.value]])]})),_:1}),Object(o.createElementVNode)("div",O,[1===Object(o.unref)(P).czType?(Object(o.openBlock)(),Object(o.createBlock)(re,{key:0,class:"at-popover",placement:"top",width:300,trigger:"click",onShow:ie,onHide:ue},{reference:Object(o.withCtx)((function(){return[Object(o.createVNode)(E,{type:"info"},{default:Object(o.withCtx)((function(){return[p]})),_:1})]})),default:Object(o.withCtx)((function(){return[Object(o.withDirectives)(Object(o.createElementVNode)("ul",{class:"infinite-list","infinite-scroll-delay":600,"infinite-scroll-disabled":oe.value,"infinite-scroll-immediate":!1},[0==ae.value.length?(Object(o.openBlock)(),Object(o.createBlock)(H,{key:0,description:"暂无数据","image-size":50})):(Object(o.openBlock)(!0),Object(o.createElementBlock)(o.Fragment,{key:1},Object(o.renderList)(ae.value,(function(e){return Object(o.openBlock)(),Object(o.createElementBlock)("li",{key:e.targetId,class:"infinite-list-item",onClick:function(t){return function(e){var t=A.value.innerText,n="@"+e.nickName+" ";A.value.innerText=t.slice(0,$.value)+n+t.slice($.value,t.length),G(A.value,$.value+n.length),J(),le.value=[].concat(Object(a.a)(le.value),[{nickName:e.nickName,targetId:e.targetId}]),console.log(le.value)}(e)}},[Object(o.createVNode)(Y,{shape:"circle",size:40,src:e.avatar||"//cube.elemecdn.com/9/c2/f0ee8a3c7c9638a54940382568c9dpng.png",fit:"fill"},null,8,["src"]),Object(o.createElementVNode)("span",{textContent:Object(o.toDisplayString)(e.nickName),class:"nickName"},null,8,k)],8,g)})),128)),Object(o.withDirectives)(Object(o.createElementVNode)("p",h,"没有更多了",512),[[o.vShow,oe.value]])],8,m),[[ge,Object(o.unref)(M).isLoadAt],[ke,ie]])]})),_:1})):Object(o.createCommentVNode)("",!0),Object(o.createVNode)(re,{class:"preset-popover",visible:ne.value,"onUpdate:visible":t[2]||(t[2]=function(e){return ne.value=e}),placement:"left",width:400,trigger:"click"},{reference:Object(o.withCtx)((function(){return[Object(o.createVNode)(E,{type:"success",disabled:!R.value,icon:"el-icon-collection"},{default:Object(o.withCtx)((function(){return[C]})),_:1},8,["disabled"])]})),default:Object(o.withCtx)((function(){return[Object(o.createVNode)(Oe,null,{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(ve,null,{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(de,{modelValue:ee.value,"onUpdate:modelValue":t[1]||(t[1]=function(e){return ee.value=e}),onInput:ce,placeholder:"输入关键字","prefix-icon":"el-icon-search",clearable:""},null,8,["modelValue"])]})),_:1}),Object(o.withDirectives)(Object(o.createVNode)(je,null,{default:Object(o.withCtx)((function(){return[0==te.value.length?(Object(o.openBlock)(),Object(o.createBlock)(H,{key:0,description:"暂无匹配项","image-size":50})):(Object(o.openBlock)(),Object(o.createBlock)(fe,{key:1,class:"presetList-box",ref:function(e,t){t.scrollbar=e}},{default:Object(o.withCtx)((function(){return[(Object(o.openBlock)(!0),Object(o.createElementBlock)(o.Fragment,null,Object(o.renderList)(te.value,(function(e,t){return Object(o.openBlock)(),Object(o.createElementBlock)("div",{key:t,onClick:function(t){return function(e){ne.value=!1,A.value.innerHTML=e,A.value.focus()}(e)},class:"listItem",innerHTML:e},null,8,x)})),128))]})),_:1},512))]})),_:1},512),[[ge,Object(o.unref)(M).isLoadPreset]])]})),_:1})]})),_:1},8,["visible"]),Object(o.createVNode)(E,{type:"primary",icon:"el-icon-promotion",onClick:F,loading:Object(o.unref)(M).isSending,disabled:!R.value},{default:Object(o.withCtx)((function(){return[w]})),_:1},8,["loading","disabled"])])]),Object(o.createElementVNode)("div",{class:"editor",contenteditable:R.value,ref:function(e,t){t.editor=e,A.value=e},onKeydown:Object(o.withKeys)(Object(o.withModifiers)(F,["prevent"]),["enter"]),onClick:J,onKeyup:J},null,40,N),Object(o.createElementVNode)("div",{class:"emoji-box",style:Object(o.normalizeStyle)({display:!0===L.value?"block":"none"})},[(Object(o.openBlock)(!0),Object(o.createElementBlock)(o.Fragment,null,Object(o.renderList)(Object.keys(S),(function(e,t){return Object(o.openBlock)(),Object(o.createElementBlock)(o.Fragment,{key:t},[t===W.value?(Object(o.openBlock)(),Object(o.createElementBlock)("section",y,[(Object(o.openBlock)(!0),Object(o.createElementBlock)(o.Fragment,null,Object(o.renderList)(S[e],(function(e,t){return Object(o.openBlock)(),Object(o.createElementBlock)("span",{onClick:function(t){return function(e){L.value=!1;var t=A.value.innerText;A.value.innerText=t.slice(0,$.value)+e+t.slice($.value,t.length),G(A.value,$.value+1),$.value=q(A.value)+1}(e)},class:"emoji-list-item",key:t},Object(o.toDisplayString)(e),9,V)})),128))])):Object(o.createCommentVNode)("",!0)],64)})),128)),Object(o.createElementVNode)("div",B,[Object(o.createElementVNode)("div",null,[Object(o.createVNode)(r,{onClick:Q},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(pe)]})),_:1})]),Object(o.createElementVNode)("div",null,[Object(o.createVNode)(r,{onClick:X},{default:Object(o.withCtx)((function(){return[Object(o.createVNode)(me)]})),_:1})])])],4)])}}},E=(n("0a34"),n("6b0d"));const S=n.n(E)()(T,[["__scopeId","data-v-5e8759e9"]]);t.default=S},f2f2:function(e,t,n){}}]);